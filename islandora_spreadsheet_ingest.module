<?php

/**
 * @file
 * General hook implementations.
 */

use Drupal\islandora_spreadsheet_ingest\RequestInterface;

/**
 * Implements hook_ENTITY_TYPE_create().
 */
function islandora_spreadsheet_ingest_isi_request_create(RequestInterface $request) {
  // If active, generate the migration group...
  // XXX: Should only actually fire when importing the config... which would
  // probably be broken due to referencing content (a file)... may have to
  // suppress/detect related errors?
  if ($request->getActive()) {
    \Drupal::service('islandora_spreadsheet_ingest.migration_group_deriver')->create($request);
    \Drupal::service('islandora_spreadsheet_ingest.migration_deriver')->createAll($request);
  }
}

/**
 * Implements hook_ENTITY_TYPE_update().
 */
function islandora_spreadsheet_ingest_isi_request_update(RequestInterface $request) {
  if ($request->getActive()) {
    // (Re)derive our migration group.
    \Drupal::service('islandora_spreadsheet_ingest.migration_group_deriver')->create($request);
    \Drupal::service('islandora_spreadsheet_ingest.migration_deriver')->createAll($request);
  }
  else {
    // Nuke the related migration group.
    \Drupal::service('islandora_spreadsheet_ingest.migration_deriver')->deleteAll($request);
    \Drupal::service('islandora_spreadsheet_ingest.migration_group_deriver')->delete($request);
  }
}

/**
 * Implements hook_ENTITY_TYPE_delete().
 */
function islandora_spreadsheet_ingest_isi_request_delete(RequestInterface $request) {
  \Drupal::service('islandora_spreadsheet_ingest.migration_deriver')->deleteAll($request);
  \Drupal::service('islandora_spreadsheet_ingest.migration_group_deriver')->delete($request);
}
